//Including common files
INCLUDE common/common.tpl
INCLUDE common/manual_stop.aiva
INCLUDE common/task_and_insight.aiva
INCLUDE common/followup/followup.aiva
INCLUDE common/followup/followup.tpl
INCLUDE Generic/Generic_2.tpl
INCLUDE Generic/Generic_3.tpl
INCLUDE common/common_track.aiva
INCLUDE AutoNation/Generic_Autonation.tpl
INCLUDE AutoNation/Autonation_common.aiva
INCLUDE jaguar/toyota/toyota_A.tpl
INCLUDE jaguar/lexus/jag_lexus.tpl

//This is the very first default track that called from AIVA file when we initiate the lead
START_TRACK DEFAULT

    S1. START

        DELETE_INSIGHT CL
        SETMARK FOLLOW_UP FALSE
        SETMARK CONTACT_LATER FALSE

		CALL_FUNCTION_SWITCH customerUtils findCustomerType -> @customerType

			R1. LEXUS_5K_NEW_A_NRTA > GOTO GENERIC_AN_5K_NEW_NRTA_1ST_TRACK:S1
			R1. LEXUS_5K_NEW_A_NRTA_TIME > GOTO GENERIC_AN_5K_NEW_NRTA_1ST_TRACK:S1
			R1. LEXUS_5K_NEW_A_RTA > GOTO AN_LEXUS_5K_NEW_RTA_1ST_TRACK:S1
			R1. LEXUS_5K_NEW_A_RTA_TIME > GOTO AN_LEXUS_5K_NEW_RTA_1ST_TRACK:S1

			R2. LEXUS_5K_USED_A_NRTA > GOTO GENERIC_AN_5K_USED_NRTA_1ST_TRACK:S1
			R2. LEXUS_5K_USED_A_NRTA_TIME > GOTO GENERIC_AN_5K_USED_NRTA_1ST_TRACK:S1
			R2. LEXUS_5K_USED_A_RTA > GOTO GENERIC_AN_5K_USED_RTA_1ST_TRACK:S1
			R2. LEXUS_5K_USED_A_RTA_TIME > GOTO GENERIC_AN_5K_USED_RTA_1ST_TRACK:S1

            R3. LEXUS_10K_NEW_B2_NRTA_TIME > GOTO GENERIC_AN_SECONDSERVICE_NRTA_1ST_TRACK:S1
            R3. LEXUS_10K_NEW_NS_NRTA_TIME > GOTO GENERIC_AN_SECONDSERVICE_NRTA_1ST_TRACK:S1
            R3. LEXUS_10K_NEW_OS_NRTA_TIME > GOTO GENERIC_AN_SECONDSERVICE_NRTA_1ST_TRACK:S1

            R3. LEXUS_10K_NEW_OS_NRTA_MILEAGE > GOTO GENERIC_AN_SECONDSERVICE_NRTA_1ST_TRACK:S1
            R3. LEXUS_10K_NEW_B2_NRTA_MILEAGE > GOTO GENERIC_AN_SECONDSERVICE_NRTA_1ST_TRACK:S1

            R3. LEXUS_10K_NEW_B2_RTA_TIME > GOTO AN_LEXUS_10K_RTA_1ST_TRACK:S1
            R3. LEXUS_10K_NEW_NS_RTA_TIME > GOTO AN_LEXUS_10K_RTA_1ST_TRACK:S1
            R3. LEXUS_10K_NEW_OS_RTA_TIME > GOTO AN_LEXUS_10K_RTA_1ST_TRACK:S1

            R3. LEXUS_10K_NEW_B2_RTA_MILEAGE > GOTO AN_LEXUS_10K_RTA_1ST_TRACK:S1
            R3. LEXUS_10K_NEW_OS_RTA_MILEAGE > GOTO AN_LEXUS_10K_RTA_1ST_TRACK:S1

			R4. LEXUS_NEXTSERVICE1_S_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SU_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SU-A_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SN-A_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_A-NOOCP_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SN-A-OC_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SU-A-OC_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_S-OC_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_A-OCP_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1

			R4. LEXUS_NEXTSERVICE1_S_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SU_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SU-A_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SN-A_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_A-NOOCP_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SN-A-OC_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_SU-A-OC_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_S-OC_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R4. LEXUS_NEXTSERVICE1_A-OCP_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1

			R5. LEXUS_NEXTSERVICE2_S_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SU_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SU-A_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SN-A_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_A-NOOCP_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SN-A-OC_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SU-A-OC_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_S-OC_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_A-OCP_NRTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_NRTA_1ST_TRACK:S1

			R5. LEXUS_NEXTSERVICE2_S_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SU_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SU-A_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SN-A_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_A-NOOCP_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SN-A-OC_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_SU-A-OC_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_S-OC_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1
			R5. LEXUS_NEXTSERVICE2_A-OCP_RTA_TIME > GOTO GENERIC_AN_NEXTSERVICE_RTA_1ST_TRACK:S1

	    END
END_TRACK

START_TRACK AN_LEXUS_5K_NEW_RTA_1ST_TRACK
	S1. START
		    SENDMESSAGE SMS AGENT CUST $AN_LEXUS_5K_NEW_RTA_1ST_TEMP
            MARK_LEAD_PHASE CONTACTED
		    SCHEDULE_FOLLOWUP RELDAY:1 ABSTIME:09:57:am GENERIC_AN_FIRSTSERVICE_RTA_1ST_NRAA_TRACK_V1:S1
	    END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
		    SWITCH_DIRECTION OUTBOUND
            MARK_LEAD_PHASE RESPONDED
		    GOTO GENERIC_ASK_4APPT_TRACK:S1
	      END
END_TRACK

START_TRACK AN_LEXUS_10K_RTA_1ST_TRACK
	S1. START
		    SENDMESSAGE SMS AGENT CUST $AN_LEXUS_10K_RTA_1ST_TEMP
            MARK_LEAD_PHASE CONTACTED
		    SCHEDULE_FOLLOWUP RELDAY:1 ABSTIME:09:57:am GENERIC_AN_RTA_1ST_NRAA_TRACK:S1
	    END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
		    SWITCH_DIRECTION OUTBOUND
            MARK_LEAD_PHASE RESPONDED
            GOTO GENERIC_ASK_4APPT_TRACK:S1
	      END
END_TRACK

START_TRACK GENERIC_NRTA_2NDTEXT_TRACK
	S1. START
        CALL_FUNCTION_SWITCH jaguarUtils checkServicePackage -> @servicePackage
            R1. LX_5K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_5K_NEW_NRTA_2ND_TEMP
            R2. LX_10K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_10K_NRTA_2ND_TEMP
            R3. LX_5K_USED > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_AN_5K_USED_NRTA_2ND_TEMP
            R4. LX_NS1 > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_AN_NEXTSERVICE_NRTA_2ND_TEMP
            R5. LX_NS2 > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_AN_NEXTSERVICE_NRTA_2ND_TEMP
            R_default. GOTO MANUAL_INTERNAL_HANDOFF:S1
	    END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
            GOTO GENERIC_ASK_4APPT_TRACK:S1
	      END
END_TRACK

START_TRACK CUST_ASK_PICKUP_SERVICE_HANDLER
	S1. START
          SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_CUST_ASK_4PICKUP_SVC_TEMP
        END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
		    GOTO GENERIC_ASK_4APPT_TRACK:S1
	       END
END_TRACK

START_TRACK CUST_ASK_IF_LOANER_AVAILABLE_HANDLER
	S1. START
          SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_GET_LOANER_TEMP
        END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
		    GOTO GENERIC_ASK_4APPT_TRACK:S1
	       END
END_TRACK

START_TRACK CUST_ASK_IF_RENTAL_AVAILABLE_HANDLER
	S1. START
          SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_GET_RENTAL_TEMP
        END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
		    GOTO GENERIC_ASK_4APPT_TRACK:S1
	       END
END_TRACK

START_TRACK CUST_ASK_IF_SHUTTLE_AVAILABLE_HANDLER
	S1. START
          SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_GET_SHUTTLE_TEMP
        END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
		    GOTO GENERIC_ASK_4APPT_TRACK:S1
	       END
END_TRACK

START_TRACK SVC_COST_HANDLER
	S1. START
        CALL_FUNCTION_SWITCH jaguarUtils checkServicePackage -> @servicePackage
            R1. LX_5K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_SVC_DETAILS_5K_10K_TEMP
            R2. LX_10K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_SVC_DETAILS_5K_10K_TEMP
            R3. LX_5K_USED > GOTO VCP_PRICECHECK_HANDLER:S1
            R4. LX_NS1 > GOTO VCP_PRICECHECK_HANDLER:S1
            R5. LX_NS2 > GOTO VCP_PRICECHECK_HANDLER:S1
            R_default. GOTO MANUAL_INTERNAL_HANDOFF:S1
	    END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
            GOTO GENERIC_ASK_4APPT_TRACK:S1
	      END
END_TRACK

START_TRACK SVC_DETAILS_HANDLER
	S1. START
        CALL_FUNCTION_SWITCH jaguarUtils checkServicePackage -> @servicePackage
            R1. LX_5K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_SVC_DETAILS_5K_10K_TEMP
            R2. LX_10K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_LEXUS_SVC_DETAILS_5K_10K_TEMP
            R3. LX_5K_USED > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_GENERIC_SVC_DETAILS_4USED_N_NEXTSERVICE_TEMP
            R4. LX_NS1 > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_GENERIC_SVC_DETAILS_4USED_N_NEXTSERVICE_TEMP
            R5. LX_NS2 > SENDMESSAGE_INTERNAL SMS AGENT SREP $AN_GENERIC_SVC_DETAILS_4USED_N_NEXTSERVICE_TEMP
            R_default. GOTO MANUAL_INTERNAL_HANDOFF:S1
	    END
	S1-R. START
		    UNSCHEDULE CUST
		    UNSCHEDULE SREP
            MARK_LEAD_PHASE ENGAGED
            GOTO GENERIC_ASK_4APPT_TRACK:S1
	      END
END_TRACK

START_TRACK GENERIC_CUST_SPECIFY_MILEAGE_HANDLER
	S1.  START
		    CALL_FUNCTION_SWITCH jaguarUtils checkServicePackage -> @servicePackage
			    //R1. LX_NS1 > (Need to define action)
			    R_default. GOTO GENERIC_CUST_SPECIFY_MILEAGE_HANDLER:S2
	     END
    S1-R. START
            UNSCHEDULE CUST
            UNSCHEDULE SREP
            SWITCH_DIRECTION OUTBOUND
    	    GOTO GENERIC_ASK_4APPT_TRACK:S1
          END
	S2.  START
		    CALL_FUNCTION_SWITCH jaguarUtils getMileageStatusByService -> @mileageStatus

			    R1. ALMOST_LIMIT_10K > SENDMESSAGE_INTERNAL SMS AGENT SREP $JAGUAR_OILCHANGE_CUSTOMER_B2_OVERRESTIMATED_MILEAGE
			    R1. ABOVE_LIMIT_10K > SENDMESSAGE_INTERNAL SMS AGENT SREP $AUTONATION_WHEN_MILEAGE_EXCEEDED_TEMP
			    R1. UNDER_LIMIT_10K > SENDMESSAGE_INTERNAL SMS AGENT SREP $AUTONATION_OBJECTION_LOW_MILEAGE_10K_TEMP
			    R1. EXACT_LIMIT > SENDMESSAGE_INTERNAL SMS AGENT SREP $AUTONATION_WHEN_MILEAGE_ARE_EXACT_TEMP

                R1. ALMOST_LIMIT > SENDMESSAGE_INTERNAL SMS AGENT SREP $JAGUAR_OILCHANGE_CUSTOMER_A_SPECIFY_MILEAGE_ALMOST_LIMIT
			    R1. ABOVE_LIMIT > SENDMESSAGE_INTERNAL SMS AGENT SREP $AUTONATION_WHEN_MILEAGE_EXCEEDED_TEMP
			    R1. UNDER_LIMIT > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_OBJECTION_LOW_MILEAGE_V2
			    R1. EXACT_LIMIT > SENDMESSAGE_INTERNAL SMS AGENT SREP $AUTONATION_WHEN_MILEAGE_ARE_EXACT_TEMP
			    R_default. GOTO MANUAL_INTERNAL_HANDOFF:S1
	     END
     S2-R. START
             UNSCHEDULE CUST
             UNSCHEDULE SREP
             SWITCH_DIRECTION OUTBOUND
     	     GOTO GENERIC_ASK_4APPT_TRACK:S1
           END
END_TRACK

START_TRACK GENERIC_OBJECT_LESS_MILEAGE_HANDLER
	S1.  START
		    CALL_FUNCTION_SWITCH jaguarUtils checkServicePackage -> @servicePackage
			    R1. LX_5K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_OBJECTION_LOW_MILEAGE_V2
			    R1. LX_5K_USED > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_OBJECTION_LOW_MILEAGE_V2
			    R1. LX_10K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $AUTONATION_OBJECTION_LOW_MILEAGE_10K_TEMP
			    R_default. GOTO MANUAL_INTERNAL_HANDOFF:S1
	     END
    S1-R. START
            UNSCHEDULE CUST
            UNSCHEDULE SREP
            SWITCH_DIRECTION OUTBOUND
    	    GOTO GENERIC_ASK_4APPT_TRACK:S1
          END
END_TRACK

START_TRACK CUST_SEEK_PLAN_DETAILS_HANDLER
	S1. START
            SENDMESSAGE_INTERNAL SMS AGENT SREP $CUST_SEEK_CARE_PLAN_DETAILS_V2_LEXUS
        END
     S1-R. START
             UNSCHEDULE CUST
             UNSCHEDULE SREP
             SWITCH_DIRECTION OUTBOUND
     	    GOTO GENERIC_ASK_4APPT_TRACK:S1
           END
END_TRACK

START_TRACK CUST_ASK_4SPARE_KEY_HANDLER
	S1. START
            SENDMESSAGE_INTERNAL SMS AGENT SREP $LEXUS_OILCHANGE_CUSTOMER_A_CUST_ASK_4SPARE_KEY
        END
     S1-R. START
             UNSCHEDULE CUST
             UNSCHEDULE SREP
             SWITCH_DIRECTION OUTBOUND
     	    GOTO GENERIC_ASK_4APPT_TRACK:S1
           END
END_TRACK

START_TRACK GENERIC_SVC_DUE_DATE_HANDLER
	S1. START
             CALL_FUNCTION_SWITCH jaguarUtils checkServicePackage -> @servicePackage
			    R1. LX_5K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_5K_SVC_DUE_DATE_TEMP
			    R2. LX_5K_USED > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_5K_SVC_DUE_DATE_TEMP
			    R3. LX_10K_NEW > SENDMESSAGE_INTERNAL SMS AGENT SREP $GENERIC_OILCHANGE_CUSTOMER_A_SVC_DUE_DATE_10K
			    R_default. GOTO MANUAL_INTERNAL_HANDOFF:S1
        END
     S1-R. START
             UNSCHEDULE CUST
             UNSCHEDULE SREP
             SWITCH_DIRECTION OUTBOUND
     	    GOTO GENERIC_ASK_4APPT_TRACK:S1
           END
END_TRACK